<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Business Date Calculator</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <div class="calculator">
        <h1>Business Date Calculator</h1>
        <div style="position: relative;">
            <select id="serviceType">
                <option value="expressPaid" selected>Express (Paid)</option>
                <option value="expressFree">Express (Free)</option>
                <option value="standard">Standard</option>
                <option value="economy">Economy</option>
                <option value="collection">Collection</option>
            </select>
            <div class="dropdown-arrow"></div>
        </div>
        <div style="position: relative;">
            <select id="countrySelect">
                <!-- Options will be populated dynamically -->
            </select>
            <div class="dropdown-arrow"></div>
        </div>
        <div style="position: relative;">
            <input type="date" id="startDate" required>
            <div class="hamburger-icon">
                <div></div>
                <div></div>
                <div></div>
            </div>
        </div>
        <input type="text" id="businessDays" placeholder="Business Days" required>
        <button id="calculateButton">Calculate</button>
        <input type="text" id="result" class="result-field" readonly>
        <div id="copyMessage" class="copy-message">Copied!</div>
    </div>

<script>
    const countryOptions = {
        expressPaid: [
            "United States", "Canada", "Australia", "Mexico", "United Kingdom", "Brazil",
            "New Zealand", "Austria", "Belgium", "Bulgaria", "Croatia", "Cyprus",
            "Czech Republic", "Denmark", "Estonia", "Finland", "France", "Germany",
            "Greece", "Hungary", "Ireland", "Italy", "Latvia", "Lithuania",
            "Luxembourg", "Malta", "Netherlands", "Poland", "Portugal", "Romania",
            "Slovakia", "Slovenia", "Spain", "Sweden"
        ],
        expressFree: ["Japan", "South Korea"],
        economy: ["United States"],
        standard: [
            "United States", "New Zealand", "Austria", "Bosnia and Herzegovina",
            "Belgium", "Bulgaria", "Croatia", "Czech Republic", "Denmark",
            "Estonia", "Finland", "France", "Germany", "Greece", "Hungary",
            "Ireland", "Italy", "Lithuania", "Luxembourg", "Latvia",
            "Netherlands", "Norway", "Poland", "Portugal", "Romania",
            "Slovenia", "Slovakia", "Spain", "Sweden", "Switzerland",
            "United Kingdom", "Brunei", "Hong Kong", "Indonesia", "Macau",
            "Malaysia", "Philippines", "Singapore", "Thailand", "Taiwan",
            "Vietnam", "Anguilla", "Antigua and Barbuda", "Aruba", "Barbados",
            "Bermuda", "Bonaire", "Cayman Islands", "Curaçao", "Dominica",
            "Dominican Republic", "Greenland", "Grenada", "Guadeloupe",
            "Haiti", "Jamaica", "Martinique", "Montserrat", "Puerto Rico",
            "Saint Barthélemy", "Saint Kitts and Nevis", "Saint Lucia",
            "Saint Martin", "Saint Pierre and Miquelon", "Saint Vincent and the Grenadines",
            "Sint Maarten", "Bahamas", "Trinidad and Tobago", "Turks and Caicos Islands",
            "British Virgin Islands", "U.S. Virgin Islands", "Belize", "Bolivia",
            "Chile", "Colombia", "Costa Rica", "Ecuador", "El Salvador",
            "Falkland Islands", "French Guiana", "Guatemala", "Guyana",
            "Honduras", "Nicaragua", "Panama", "Paraguay", "Peru",
            "South Georgia and the South Sandwich Islands", "Suriname",
            "Uruguay", "Venezuela"
        ],
        collection: ["United States", "Canada"],
    };

    let holidays = {};

        async function fetchHolidays(country) {
            const year = new Date().getFullYear();
            const response = await fetch(`https://date.nager.at/api/v2/PublicHolidays/${year}/${country}`);
            if (response.ok) {
                holidays[country] = await response.json();
            } else {
                console.error(`Failed to fetch holidays for ${country}`);
            }
        }

        function isHoliday(date, country) {
            if (!holidays[country]) return false;
            return holidays[country].some(holiday => 
                new Date(holiday.date).toDateString() === date.toDateString()
            );
        }

        function calculateBusinessDays(startDate, numDays, country) {
            let currentDate = new Date(startDate);
            let count = 0;

            while (count < numDays) {
                currentDate.setDate(currentDate.getDate() + 1);
                if (currentDate.getDay() !== 0 && currentDate.getDay() !== 6 && !isHoliday(currentDate, country)) {
                    count++;
                }
            }
            return currentDate;
        }

        async function populateCountries() {
            const countrySelect = document.getElementById('countrySelect');
            const selectedService = document.getElementById('serviceType').value;
            const countries = countryOptions[selectedService];

            countrySelect.innerHTML = '';
            for (const country of countries) {
                const option = document.createElement('option');
                option.value = country;
                option.textContent = country;
                countrySelect.appendChild(option);
                await fetchHolidays(country);
            }
        }

        document.getElementById('serviceType').addEventListener('change', populateCountries);

        async function calculateBusinessDate() {
            const dateRangeInput = document.getElementById('businessDays').value;
            const selectedCountry = document.getElementById('countrySelect').value;

            if (!dateRangeInput || !selectedCountry) {
                alert('Please enter a valid date range and select a country.');
                return;
            }

            const startDate = new Date(document.getElementById('startDate').value);
            const [minDays, maxDays] = dateRangeInput.split('-').map(Number);

            const endDate1 = calculateBusinessDays(startDate, minDays, selectedCountry);
            const endDate2 = calculateBusinessDays(startDate, maxDays, selectedCountry);

            const finalEndDate1 = adjustForHolidays(endDate1, selectedCountry);
            const finalEndDate2 = adjustForHolidays(endDate2, selectedCountry);

            const options = { month: 'long', day: 'numeric', year: 'numeric' };
            document.getElementById('result').value = `Between ${finalEndDate1.toLocaleDateString('en-US', options)} and ${finalEndDate2.toLocaleDateString('en-US', options)}`;
        }

        function adjustForHolidays(date, country) {
            while (isHoliday(date, country)) {
                date.setDate(date.getDate() + 1);
            }
            return date;
        }

        document.getElementById('calculateButton').addEventListener('click', calculateBusinessDate);

        document.getElementById('result').addEventListener('click', () => {
            const resultField = document.getElementById('result');
            navigator.clipboard.writeText(resultField.value).then(() => {
                const copyMessage = document.getElementById('copyMessage');
                copyMessage.style.display = 'block';
                setTimeout(() => {
                    copyMessage.style.display = 'none';
                }, 2000);
            });
        });

        populateCountries();
</script>
</body>
</html>
